webpack_encore:
    # The path where Encore is building the assets - i.e. Encore.setOutputPath()
    output_path: '%kernel.project_dir%/public/build'
    
    # Set attributes that will be rendered on all script and link tags
    script_attributes:
        defer: true
        # Enable for Turbo Drive asset reloading
        'data-turbo-track': reload
    link_attributes:
        # Enable for Turbo Drive asset reloading
        'data-turbo-track': reload

    # Enable crossorigin for SRI (Subresource Integrity)
    crossorigin: 'anonymous'

    # Preload all rendered script and link tags automatically via the HTTP/2 Link header
    preload: true

    # Throw an exception if the entrypoints.json file is missing
    strict_mode: true

framework:
    assets:
        json_manifest_path: '%kernel.project_dir%/public/build/manifest.json'

when@prod:
    webpack_encore:
        # Cache the entrypoints.json (rebuild Symfony's cache when entrypoints.json changes)
        cache: true
        # Disable strict mode in production to prevent errors if entrypoints change
        strict_mode: false

when@test:
    webpack_encore:
        # Disable strict mode in tests
        strict_mode: false
        # Disable preloading in tests
        preload: false
